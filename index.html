<!DOCTYPE html>
<html lang="tr">

<head>
<meta charset="UTF-8">
<title>TraderArmy Pro Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://s3.tradingview.com/tv.js"></script>

<style>

/* ======================================================
   SOFT PRO BLUE GLOBAL TEMA
   ====================================================== */

body{
    background:#0b1220;
    color:#dbe4ff;
    margin:0;
    font-family:Arial, sans-serif;
}

header, footer, .toolbar, .alarm-box, #newsTicker, #calendar-block{
    background:#111827;
    border-color:#1e293b;
}

/* GRAFİK KUTULARI */
.chart-box{
    background:#0f172a;
    border:1px solid #1e293b;
    display:flex;
    flex-direction:column;
    min-height:0;
}

/* SEÇİCİLER */
button, select, input{
    background:#1e293b;
    color:#dbe4ff;
    border:1px solid #334155;
    padding:6px 10px;
    border-radius:4px;
}
button:hover, select:hover{
    background:#2563eb;
    border-color:#3b82f6;
}

/* ======================================================
   4’LÜ KÜÇÜLME SORUNU TAM FIX
   ====================================================== */

/* Ana grid */
#charts{
    display:grid;
    height:calc(100vh - 120px) !important;
    width:100%;
}

/* 1,2,4 mod için grid düzeni */
body.layout-1 #charts{
    grid-template-columns:1fr !important;
    grid-template-rows:1fr !important;
}
body.layout-2 #charts{
    grid-template-columns:1fr 1fr !important;
    grid-template-rows:1fr !important;
}
body.layout-4 #charts{
    grid-template-columns:1fr 1fr !important;
    grid-template-rows:1fr 1fr !important;
}

/* 4'lü mod tam yüksek kutu */
body.layout-4 .chart-box{
    min-height:0 !important;
    height:100% !important;
}

/* TradingView DIV boyut fix */
.chart{
    width:100% !important;
    height:100% !important;
    min-height:0 !important;
    flex:1;
}

/* ======================================================
   HABER BANDI
   ====================================================== */

#newsTicker{
    height:38px;
    display:flex;
    align-items:center;
    overflow:hidden;
}
#newsTicker span{
    background:#b91c1c;
    padding:6px 12px;
    font-weight:bold;
    margin-right:10px;
}
#tickerContent{
    white-space:nowrap;
    color:#cdd6f4;
    animation:ticker 25s linear infinite;
}
@keyframes ticker{
    0%{transform:translateX(100%)}
    100%{transform:translateX(-100%)}
}

/* TOOLBAR */
.toolbar{
    padding:6px;
    display:flex;
    gap:6px;
}

/* ALARM */
.alarm-box{
    padding:6px;
    display:flex;
    gap:6px;
}
.alarm-list{
    font-size:12px;
    border-top:1px solid #1e293b;
    color:#cdd6f4;
    padding:6px;
}

/* FOOTER */
footer{
    text-align:center;
    padding:10px;
    font-size:12px;
}

</style>
</head>


<body class="layout-1">

<!-- HABER BANDI -->
<div id="newsTicker">
    <span>SON DAKİKA</span>
    <div id="tickerContent">Haberler yükleniyor...</div>
</div>

<!-- HEADER -->
<header>
    <strong style="font-size:18px;">TraderArmy</strong>

    <button onclick="setLayout(1)">1 Grafik</button>
    <button onclick="setLayout(2)">2 Grafik</button>
    <button onclick="setLayout(4)">4 Grafik</button>

    <button onclick="toggleCalendar()">Takvim Aç/Kapat</button>
</header>

<!-- TAKVİM -->
<div id="calendar-block">
    <div class="tradingview-widget-container" style="height:250px;">
        <div class="tradingview-widget-container__widget"></div>
        <script src="https://s3.tradingview.com/external-embedding/embed-widget-events.js" async>
        {
            "colorTheme":"dark",
            "width":"100%",
            "height":"250",
            "locale":"tr",
            "importanceFilter":"0,1,2",
            "countryFilter":"US,EU,GB,JP,CA,CH,AU,NZ"
        }
        </script>
    </div>
</div>

<!-- GRAFİKLER -->
<div id="charts"></div>

<!-- FOOTER -->
<footer>
⚠️ Bu platform yatırım tavsiyesi değildir. Tüm risk kullanıcıya aittir.
</footer>

<script>

/* PARİTELER */
const symbolsList = [
    "FX:EURUSD","FX:GBPUSD","FX:USDJPY","FX:XAUUSD","FX:USDTRY",
    "BINANCE:BTCUSDT","BINANCE:ETHUSDT","BINANCE:XRPUSDT",
    "OANDA:NAS100","OANDA:SPX500","OANDA:US30"
];
const defaults=[
    "FX:EURUSD",
    "BINANCE:BTCUSDT",
    "OANDA:NAS100",
    "FX:XAUUSD"
];

let layout=1;
let calendarVisible=true;
let alarms=JSON.parse(localStorage.getItem("alarms")||"[]");
let chartSymbols=[];

/* HABER DÖNGÜ */
const tick=["FED faiz beklentisi","ABD enflasyon verisi","NFP Tarım dışı","ECB toplantısı","Kripto piyasa hareketli"];
let ti=0;
function rot(){
    document.getElementById("tickerContent").innerText=tick[ti];
    ti=(ti+1)%tick.length;
}
rot(); setInterval(rot,6000);

/* TAKVİM AÇ KAPA */
function toggleCalendar(){
    const cal=document.getElementById("calendar-block");
    const ch=document.getElementById("charts");

    if(calendarVisible){
        cal.style.display="none";
        ch.style.height="calc(100vh - 80px)";
    } else {
        cal.style.display="block";
        ch.style.height="calc(100vh - 120px)";
    }
    calendarVisible=!calendarVisible;

    setTimeout(()=>window.dispatchEvent(new Event("resize")),50);
}

/* DROPDOWN */
function makeDropdown(i){
    let html="";
    for(const s of symbolsList){
        const sel=(chartSymbols[i]===s)?"selected":"";
        html+=`<option ${sel} value="${s}">${s}</option>`;
    }
    return html;
}

/* LAYOUT */
function setLayout(n){
    layout=n;

    document.body.classList.remove("layout-1","layout-2","layout-4");
    document.body.classList.add("layout-"+n);

    render();
}

/* RENDER GRAFİKLER */
function render(){
    const area=document.getElementById("charts");
    area.innerHTML="";

    for(let i=0;i<layout;i++){
        createBox(i);
    }

    setTimeout(()=>window.dispatchEvent(new Event("resize")),100);
}

/* BOX */
function createBox(i){
    const area=document.getElementById("charts");
    const box=document.createElement("div");
    box.className="chart-box";

    const tb=document.createElement("div");
    tb.className="toolbar";
    tb.innerHTML=`
        <select onchange="chgSym(${i},this.value)">${makeDropdown(i)}</select>
        <select onchange="chgTf(${i},this.value)">
            <option value="1">1m</option>
            <option value="5">5m</option>
            <option value="15">15m</option>
            <option value="60">1H</option>
            <option value="240">4H</option>
            <option value="D">1D</option>
        </select>
    `;

    const chart=document.createElement("div");
    chart.className="chart";
    chart.id="tv"+i;

    const al=document.createElement("div");
    al.className="alarm-box";
    al.innerHTML=`<input id="al${i}" placeholder="Alarm fiyat">
        <button onclick="addAlarm(${i})">+</button>`;

    const list=document.createElement("div");
    list.className="alarm-list";
    list.id="list"+i;

    box.append(tb,chart,al,list);
    area.appendChild(box);

    loadChart(i);
    refreshList(i);
}

/* TRADINGVIEW */
function loadChart(i){
    if(!chartSymbols[i]) chartSymbols[i]=defaults[i];

    new TradingView.widget({
        container_id:"tv"+i,
        width:"100%",
        height:"100%",
        symbol:chartSymbols[i],
        interval:"15",
        timezone:"Europe/Istanbul",
        theme:"dark",
        style:"1",
        locale:"tr",
        hide_side_toolbar:false,
        withdateranges:true
    });
}

/* PARİTE & TF */
function chgSym(i,v){
    chartSymbols[i]=v;
    render();
}
function chgTf(i,v){
    render();
}

/* ALARM */
function addAlarm(i){
    const sym=chartSymbols[i];
    const price=parseFloat(document.getElementById("al"+i).value);
    if(!price) return alert("Fiyat gir");

    alarms.push({sym,price});
    localStorage.setItem("alarms",JSON.stringify(alarms));
    refreshList(i);
}
function refreshList(i){
    const list=alarms.filter(a=>a.sym===chartSymbols[i]);
    document.getElementById("list"+i).innerHTML =
        list.map(a=>`${a.sym} → ${a.price}`).join("<br>");
}

render();

</script>

</body>
</html>
