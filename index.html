<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>TraderArmy PRO+</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Lightweight Charts -->
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>

<style>
body {
    margin:0;
    background:#0f0f0f;
    font-family:Arial;
    color:white;
    overflow:hidden;
}

header {
    background:#111;
    padding:10px;
    display:flex;
    gap:10px;
    border-bottom:1px solid #222;
    flex-wrap:wrap;
}

button, select {
    background:#1a1a1a;
    color:white;
    border:1px solid #333;
    padding:6px 8px;
    border-radius:4px;
}

#charts {
    display:grid;
    height:calc(100vh - 160px);
}

.chart-box {
    border:1px solid #222;
    position:relative;
}

.toolbar {
    background:#111;
    padding:5px;
    border-bottom:1px solid #222;
    display:flex;
    gap:5px;
    flex-wrap:wrap;
}

.draw-btn { background:#333; padding:6px; border-radius:4px; }

footer {
    background:#111;
    color:#aaa;
    padding:10px;
    text-align:center;
    font-size:12px;
    border-top:1px solid #222;
}
</style>
</head>

<body>

<header>
    <strong>TraderArmy PRO+</strong>
    <button onclick="setLayout(1)">1 Grafik</button>
    <button onclick="setLayout(2)">2 Grafik</button>
    <button onclick="setLayout(4)">4 Grafik</button>

    <select id="symbolSelect">
        <optgroup label="Forex">
            <option value="ESCAPED:EURUSD">EURUSD</option>
            <option value="ESCAPED:GBPUSD">GBPUSD</option>
            <option value="ESCAPED:USDJPY">USDJPY</option>
            <option value="ESCAPED:XAUUSD">XAUUSD</option>
        </optgroup>

        <optgroup label="Kripto">
            <option value="BINANCE:BTCUSDT">BTCUSDT</option>
            <option value="BINANCE:ETHUSDT">ETHUSDT</option>
            <option value="BINANCE:XRPUSDT">XRPUSDT</option>
        </optgroup>

        <optgroup label="Endeks">
            <option value="INDEX:SPX">S&P 500</option>
            <option value="INDEX:NSDQ">NASDAQ</option>
        </optgroup>
    </select>

    <button onclick="loadAllCharts()">Uygula</button>
</header>

<div id="charts"></div>

<footer>
⚠️ Yasal Uyarı: Bu platform yatırım tavsiyesi değildir. Tüm finansal işlemler risk içerir.
</footer>

<script>
let layout = 1;
let charts = [];

function setLayout(n){
    layout = n;
    renderCharts();
}

function renderCharts(){
    const area = document.getElementById("charts");
    area.innerHTML = "";

    if(layout === 1){
        area.style.gridTemplateColumns = "1fr";
        area.style.gridTemplateRows = "1fr";
    }
    if(layout === 2){
        area.style.gridTemplateColumns = "1fr 1fr";
        area.style.gridTemplateRows = "1fr";
    }
    if(layout === 4){
        area.style.gridTemplateColumns = "1fr 1fr";
        area.style.gridTemplateRows = "1fr 1fr";
    }

    charts = [];

    for(let i=0;i<layout;i++){
        const box = document.createElement("div");
        box.className = "chart-box";
        box.id = "box"+i;
        area.appendChild(box);

        createChart(i);
    }
}

function createChart(i){
    const box = document.getElementById("box"+i);

    const toolbar = document.createElement("div");
    toolbar.className = "toolbar";
    toolbar.innerHTML = `
        <button class="draw-btn" onclick="startDraw(${i}, 'trend')">Trend</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'horizontal')">H-Line</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'fib')">Fib</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'rect')">Kutu</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'brush')">Fırça</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'long')">Long</button>
        <button class="draw-btn" onclick="startDraw(${i}, 'short')">Short</button>
        <button class="draw-btn" onclick="clearDraw(${i})">Temizle</button>
    `;
    box.appendChild(toolbar);

    const div = document.createElement("div");
    div.style.height = "100%";
    div.style.width = "100%";
    div.id = "chart"+i;
    box.appendChild(div);

    const chart = LightweightCharts.createChart(div,{
        layout:{background:{color:"#0f0f0f"}, textColor:"white"},
        grid:{vertLines:{color:"#222"}, horzLines:{color:"#222"}},
        rightPriceScale:{borderColor:"#333"},
        timeScale:{borderColor:"#333"}
    });

    charts.push(chart);

    loadSymbol(i);
}

function loadSymbol(i){
    const symbol = document.getElementById("symbolSelect").value;
    const price = charts[i].addCandlestickSeries();

    fetch("https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h")
    .then(r=>r.json())
    .then(d=>{
        const data = d.map(k=>({
            time:Math.floor(k[0]/1000),
            open:k[1],
            high:k[2],
            low:k[3],
            close:k[4]
        }));
        price.setData(data);
    });
}

function loadAllCharts(){
    for(let i=0;i<layout;i++){
        loadSymbol(i);
    }
}

function startDraw(i,type){
    alert("Çizim aktif: " + type + "\n(bu versiyonda demo uyarısı)");
}
function clearDraw(i){
    alert("Çizimler temizlendi");
}

renderCharts();
</script>

</body>
</html>
